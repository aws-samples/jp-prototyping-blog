"use strict";(self.webpackChunkjp_prototyping_blog=self.webpackChunkjp_prototyping_blog||[]).push([[9281],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>c});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},o={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,p=e.parentName,m=u(e,["components","mdxType","originalType","parentName"]),d=s(n),c=l,k=d["".concat(p,".").concat(c)]||d[c]||o[c]||r;return n?a.createElement(k,i(i({ref:t},m),{},{components:n})):a.createElement(k,i({ref:t},m))}));function c(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=d;var u={};for(var p in t)hasOwnProperty.call(t,p)&&(u[p]=t[p]);u.originalType=e,u.mdxType="string"==typeof e?e:l,i[1]=u;for(var s=2;s<r;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6361:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>o,frontMatter:()=>r,metadata:()=>u,toc:()=>s});var a=n(7462),l=(n(7294),n(3905));const r={title:"Fluentd \u304b\u3089 Kinesis Data Streams \u3078\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\u3059\u308b",slug:"fluentd-kds",tags:["fluentd","kinesis data streams","kinesis"],authors:["statefb"]},i=void 0,u={permalink:"/blog/fluentd-kds",editUrl:"https://github.com/aws-samples/jp-prototyping-blog/edit/main/blog/2023-01-05-fluentd-kds/index.md",source:"@site/blog/2023-01-05-fluentd-kds/index.md",title:"Fluentd \u304b\u3089 Kinesis Data Streams \u3078\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\u3059\u308b",description:"Kinesis Data Streams \u306b\u306f\u30011 \u30ec\u30b3\u30fc\u30c9\u306e\u30b5\u30a4\u30ba\u306f 1MB \u4ee5\u4e0b\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u5236\u7d04\u304c\u3042\u308a\u3001\u30b5\u30a4\u30ba\u306e\u5927\u304d\u3044\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\u3059\u308b\u306b\u306f\u5de5\u592b\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\u307e\u305f\u5229\u7528\u6599\u91d1\u306f\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u8aad\u307f\u66f8\u304d\u3055\u308c\u308b\u30c7\u30fc\u30bf\u91cf\u306b\u57fa\u3065\u3044\u3066\u6c7a\u5b9a\u3055\u308c\u308b\u305f\u3081\u3001\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u3068\u8ab2\u91d1\u984d\u3082\u5897\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u672c\u8a18\u4e8b\u3067\u306f Publisher \u304c Fluentd \u306e\u5834\u5408\u306b\u304a\u3044\u3066\u3001\u4e0a\u8a18\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u672c\u4f53\u306b\u5206\u5272\u3057\u3001\u672c\u4f53\u306f S3 \u7d4c\u7531\u3067 Consumer \u306b\u6e21\u3057\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u307f\u3092 Kinesis Data Streams \u3078\u9001\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002",date:"2023-01-05T00:00:00.000Z",formattedDate:"2023\u5e741\u67085\u65e5",tags:[{label:"fluentd",permalink:"/blog/tags/fluentd"},{label:"kinesis data streams",permalink:"/blog/tags/kinesis-data-streams"},{label:"kinesis",permalink:"/blog/tags/kinesis"}],readingTime:12.29,hasTruncateMarker:!0,authors:[{name:"Takehiro Suzuki",title:"Prototyping Engineer",url:"https://github.com/statefb",imageURL:"https://github.com/statefb.png",key:"statefb"}],frontMatter:{title:"Fluentd \u304b\u3089 Kinesis Data Streams \u3078\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\u3059\u308b",slug:"fluentd-kds",tags:["fluentd","kinesis data streams","kinesis"],authors:["statefb"]},prevItem:{title:"Cognito Identity Pools \u306e Unauthenticated Role \u3067 Amazon Kendra \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3089 AccessDeniedException \u3060\u3063\u305f\u8a71",permalink:"/blog/identity-pool-unauth"},nextItem:{title:"Ruby on Rails \u3092 API Gateway + Lambda \u3067\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u904b\u7528\u3059\u308b\u65b9\u6cd5",permalink:"/blog/rails-lambda"}},p={authorsImageUrls:[void 0]},s=[{value:"Kinesis Data Streams \u306b\u3064\u3044\u3066",id:"kinesis-data-streams-\u306b\u3064\u3044\u3066",level:2},{value:"\u65b9\u91dd",id:"\u65b9\u91dd",level:2},{value:"\u60f3\u5b9a\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u4f8b",id:"\u60f3\u5b9a\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u4f8b",level:2},{value:"Fluentd \u306e\u30d0\u30c3\u30d5\u30a1\u30ea\u30f3\u30b0",id:"fluentd-\u306e\u30d0\u30c3\u30d5\u30a1\u30ea\u30f3\u30b0",level:2},{value:"\u30c1\u30e3\u30f3\u30af",id:"\u30c1\u30e3\u30f3\u30af",level:3},{value:"Fluentd \u81ea\u8eab\u306e\u30ed\u30b0\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b",id:"fluentd-\u81ea\u8eab\u306e\u30ed\u30b0\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b",level:2},{value:"Fluentd \u306e\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3",id:"fluentd-\u306e\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3",level:2},{value:"\u30ed\u30b0\u30ec\u30d9\u30eb\u306e\u8a2d\u5b9a",id:"\u30ed\u30b0\u30ec\u30d9\u30eb\u306e\u8a2d\u5b9a",level:3},{value:"S3",id:"s3",level:3},{value:"Fluentd \u81ea\u8eab\u306e\u30ed\u30b0\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0",id:"fluentd-\u81ea\u8eab\u306e\u30ed\u30b0\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0",level:3},{value:"KDS",id:"kds",level:3},{value:"\u307e\u3068\u3081",id:"\u307e\u3068\u3081",level:2}],m={toc:s};function o(e){let{components:t,...r}=e;return(0,l.kt)("wrapper",(0,a.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://aws.amazon.com/jp/kinesis/data-streams/"},"Kinesis Data Streams")," \u306b\u306f\u30011 \u30ec\u30b3\u30fc\u30c9\u306e\u30b5\u30a4\u30ba\u306f 1MB \u4ee5\u4e0b\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u5236\u7d04\u304c\u3042\u308a\u3001\u30b5\u30a4\u30ba\u306e\u5927\u304d\u3044\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\u3059\u308b\u306b\u306f\u5de5\u592b\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\u307e\u305f\u5229\u7528\u6599\u91d1\u306f\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u8aad\u307f\u66f8\u304d\u3055\u308c\u308b\u30c7\u30fc\u30bf\u91cf\u306b\u57fa\u3065\u3044\u3066\u6c7a\u5b9a\u3055\u308c\u308b\u305f\u3081\u3001\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u3068\u8ab2\u91d1\u984d\u3082\u5897\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u672c\u8a18\u4e8b\u3067\u306f Publisher \u304c Fluentd \u306e\u5834\u5408\u306b\u304a\u3044\u3066\u3001\u4e0a\u8a18\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u672c\u4f53\u306b\u5206\u5272\u3057\u3001\u672c\u4f53\u306f S3 \u7d4c\u7531\u3067 Consumer \u306b\u6e21\u3057\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u307f\u3092 Kinesis Data Streams \u3078\u9001\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002"),(0,l.kt)("p",null,(0,l.kt)("img",{src:n(709).Z,width:"511",height:"250"})),(0,l.kt)("h2",{id:"kinesis-data-streams-\u306b\u3064\u3044\u3066"},"Kinesis Data Streams \u306b\u3064\u3044\u3066"),(0,l.kt)("p",null,"Kinesis Data Streams (\u4ee5\u964d KDS \u3068\u547c\u79f0) \u306f\u3001\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9\u306e\u30b5\u30fc\u30d0\u30ec\u30b9\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\u30b7\u30f3\u30d7\u30eb\u306a\u5f93\u91cf\u5236\u8ab2\u91d1\u3092\u63a1\u7528\u3057\u3066\u304a\u308a\u3001\u30b7\u30e3\u30fc\u30c9\u306e\u7a3c\u50cd\u6642\u9593\u306b\u5fdc\u3058\u3066\u6599\u91d1\u306f\u8a08\u7b97\u3055\u308c\u307e\u3059\u3002\u30b7\u30e3\u30fc\u30c9\u306f\u57fa\u672c\u7684\u306a\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u5358\u4f4d\u3067\u3042\u308a\u3001\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6\u306b\u5fdc\u3058\u3066\u5fc5\u8981\u306a\u30b7\u30e3\u30fc\u30c9\u6570\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u306a\u304a\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u30e2\u30fc\u30c9\u3092\u5229\u7528\u3057\u305f\u5834\u5408\u3001\u8aad\u307f\u66f8\u304d\u306e\u30c7\u30fc\u30bf\u91cf\u306b\u5fdc\u3058\u3066\u81ea\u52d5\u7684\u306b\u30b7\u30e3\u30fc\u30c9\u6570\u306e\u30b9\u30b1\u30fc\u30eb\u304c\u884c\u308f\u308c\u307e\u3059\u3002\u8a73\u7d30\u306f",(0,l.kt)("a",{parentName:"p",href:"https://aws.amazon.com/jp/kinesis/data-streams/pricing/"},"Amazon Kinesis Data Streams \u306e\u6599\u91d1"),"\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u307e\u305f KDS \u3067\u306f 1 \u30ec\u30b3\u30fc\u30c9\u306e\u30b5\u30a4\u30ba\u304c 1MB \u4ee5\u4e0b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8a73\u7d30\u306f",(0,l.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/streams/latest/dev/service-sizes-and-limits.html"},"Quotas and Limits"),"\u3092\u3054\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002"),(0,l.kt)("h2",{id:"\u65b9\u91dd"},"\u65b9\u91dd"),(0,l.kt)("p",null,"\u5404\u30ec\u30b3\u30fc\u30c9\u306b\u30e6\u30cb\u30fc\u30af\u306a ID \u3092\u5272\u308a\u5f53\u3066\u3001KDS \u3067\u306f ID \u306e\u307f\u3092\u3001S3 \u30d0\u30b1\u30c3\u30c8\u3078\u306f\u30ec\u30b3\u30fc\u30c9\u306e\u672c\u4f53\u3092\u305d\u308c\u305e\u308c\u9001\u4fe1\u3057\u307e\u3059\u3002\u30d0\u30b1\u30c3\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30ad\u30fc\u306b ID \u3092\u542b\u307e\u305b\u3066\u304a\u3051\u3070\u3001Consumer \u5074\u3067 ID \u3092\u5143\u306b\u30d0\u30b1\u30c3\u30c8\u304b\u3089\u672c\u4f53\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u51e6\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a KDS \u3067\u53d6\u308a\u6271\u3046\u30ec\u30b3\u30fc\u30c9\u306e\u30b5\u30a4\u30ba\u3092\u524a\u6e1b\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\u672c\u8a18\u4e8b\u3067\u306f\u3001Fluentd \u3092\u7528\u3044\u305f\u5834\u5408\u306b\u3064\u3044\u3066\u5177\u4f53\u7684\u306b\u89e3\u8aac\u3057\u307e\u3059\u3002"),(0,l.kt)("h2",{id:"\u60f3\u5b9a\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u4f8b"},"\u60f3\u5b9a\u3059\u308b\u30ec\u30b3\u30fc\u30c9\u4f8b"),(0,l.kt)("p",null,"\u30b5\u30a4\u30ba\u306e\u5927\u304d\u306a\u30ec\u30b3\u30fc\u30c9\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-record.json"},'[\n    {\n        "metrics_name": "metrics1",\n        "metrics_value": 24.1,\n        ...\n    },\n    {\n        "metrics_name": "metrics2",\n        "metrics_value": 312.56,\n        ...\n    },\n    ...\u4ee5\u964d\u7d9a\u304f\n]\n\n')),(0,l.kt)("p",null,"\u4e0a\u8a18\u306e\u914d\u5217\u3092\u300c1 \u30ec\u30b3\u30fc\u30c9\u300d\u3068\u3057\u3066\u53d6\u308a\u6271\u3046\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u4f8b\u306e\u5834\u5408\u3001\u5404",(0,l.kt)("inlineCode",{parentName:"p"},"metrics"),"\u3092\u5225\u3005\u306e\u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\u53d6\u308a\u6271\u3048\u3070\u30b5\u30a4\u30ba\u3092 1MB \u306b\u6291\u3048\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3057\u3087\u3046\u3002\u3057\u304b\u3057 Fluentd \u306e\u5165\u529b\u5074\u306e\u90fd\u5408\u3084 (\u6280\u8853\u7684\u306a\u8ab2\u984c\u3084\u7d44\u7e54\u7684\u306a\u4e8b\u60c5)\u3001\u500b\u3005\u306e",(0,l.kt)("inlineCode",{parentName:"p"},"metrics"),"\u9593\u306b\u4f9d\u5b58\u95a2\u4fc2\u304c\u3042\u308b\u305f\u3081 Consumer \u5074\u3067\u306f\u307e\u3068\u3081\u3066\u51e6\u7406\u3057\u305f\u65b9\u304c\u898b\u901a\u3057\u304c\u826f\u3044\u7b49\u306e\u4e8b\u60c5\u306b\u3088\u308a\u3001\u5206\u5272\u3059\u308b\u3053\u3068\u304c\u56f0\u96e3\u307e\u305f\u306f\u59a5\u5f53\u3067\u306a\u3044\u30b1\u30fc\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u4e0a\u8a18\u306e\u914d\u5217\u5358\u4f4d\u3067\u9806\u5e8f\u6027\u304c\u62c5\u4fdd\u3055\u308c\u308c\u3070\u826f\u3044\u5834\u5408\u3001KDS \u306b\u3059\u3079\u3066\u9001\u4fe1\u3059\u308b\u3068\u524d\u8ff0\u306e\u30b3\u30b9\u30c8\u4f53\u7cfb\u306b\u3088\u308a\u4e88\u7b97\u9762\u3067\u53b3\u3057\u3044\u30b1\u30fc\u30b9\u3082\u8003\u3048\u308c\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u8ab2\u984c\u3092\u524d\u8ff0\u306e\u65b9\u91dd\u306b\u3088\u308a\u89e3\u6c7a\u3092\u56f3\u308a\u307e\u3059\u3002"),(0,l.kt)("h2",{id:"fluentd-\u306e\u30d0\u30c3\u30d5\u30a1\u30ea\u30f3\u30b0"},"Fluentd \u306e\u30d0\u30c3\u30d5\u30a1\u30ea\u30f3\u30b0"),(0,l.kt)("p",null,"Fluentd \u3067\u306f\u30ec\u30b3\u30fc\u30c9\u3092\u30d0\u30c3\u30d5\u30a1\u30ea\u30f3\u30b0\u3057\u3001\u307e\u3068\u3081\u3066\u9001\u4fe1\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30ed\u30b0\u306e\u6b20\u640d\u9632\u6b62\u3084\u6d41\u91cf\u306e\u5236\u5fa1\u304c\u53ef\u80fd\u3067\u3059\u3002\u672c\u8a18\u4e8b\u3067\u306f\u30d0\u30c3\u30d5\u30a1\u30ea\u30f3\u30b0\u306e\u5229\u7528\u3092\u524d\u63d0\u3068\u3057\u307e\u3059\u3002"),(0,l.kt)("p",null,"Fluentd \u306e\u30d0\u30c3\u30d5\u30a1\u306e\u4ed5\u7d44\u307f\u3092\u4e0b\u8a18\u306b\u793a\u3057\u307e\u3059\u3002\n",(0,l.kt)("img",{src:n(5318).Z,width:"1212",height:"563"}),"\n",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/buffer"},"\u5f15\u7528\u5148")),(0,l.kt)("p",null,"\u30d0\u30c3\u30d5\u30a1\u30ea\u30f3\u30b0\u306b\u306f stage \u3068 queue \u306e 2 \u30b9\u30c6\u30c3\u30d7\u304c\u5b58\u5728\u3057\u307e\u3059\u3002stage \u306e\u6bb5\u968e\u3067\u30a4\u30d9\u30f3\u30c8\u306e\u584a\u3067\u3042\u308b\u30c1\u30e3\u30f3\u30af (chunk) \u3092\u4f5c\u6210\u3057\u3001\u6642\u9593\u7d4c\u904e\u3068\u3068\u3082\u306b\u30a8\u30f3\u30ad\u30e5\u30fc\u3055\u308c\u3001Output Plugin \u306e\u6307\u5b9a\u3059\u308b\u5b9b\u5148\u3078\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\u306a\u304a\u30a4\u30d9\u30f3\u30c8\u306f\u30ec\u30b3\u30fc\u30c9 (\u9001\u4fe1\u3057\u305f\u3044\u30c7\u30fc\u30bf\u672c\u4f53)\u3001\u30bf\u30b0\u3001\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e 3 \u3064\u306e\u8981\u7d20\u304b\u3089\u69cb\u6210\u3055\u308c\u307e\u3059\u3002\u30bf\u30b0\u306f Fluentd \u306e\u5099\u3048\u308b\u4e3b\u8981\u306a\u8981\u7d20\u3067\u3042\u308a\u3001Fluentd \u306e\u5185\u90e8\u3067\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u5229\u7528\u3055\u308c\u307e\u3059\u3002Fluentd \u3078\u30c7\u30fc\u30bf\u3092\u6295\u5165\u3059\u308b Input Plugin \u306f\u30ec\u30b3\u30fc\u30c9\u306b\u30bf\u30b0\u3092\u3064\u3051\u3001Fluentd \u306f\u305d\u306e\u30bf\u30b0\u306b\u30de\u30c3\u30c1\u3059\u308b",(0,l.kt)("inlineCode",{parentName:"p"},"match"),"\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u691c\u7d22\u3057\u3001\u5bfe\u5fdc\u3059\u308b Output Plugin \u3078\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3057\u307e\u3059\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u305f\u3068\u3048\u3070\u4e0b\u8a18\u306e\u3088\u3046\u306a 2 \u3064\u306e\u30c0\u30df\u30fc\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u30bf\u30b0\u306f",(0,l.kt)("inlineCode",{parentName:"p"},"example.hello"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"example.hoge"),"\u3067\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'<source>\n  @type dummy\n  dummy {"hello": "world"}\n  tag example.hello\n</source>\n\n<source>\n  @type dummy\n  dummy {"hoge": "hoge"}\n  tag example.hoge\n</source>\n')),(0,l.kt)("p",null,"\u4e0a\u8a18\u4e21\u65b9\u3068\u3082\u306b",(0,l.kt)("inlineCode",{parentName:"p"},"example_bucket"),"\u3068\u3044\u3046\u540d\u524d\u306e S3 \u30d0\u30b1\u30c3\u30c8\u3078\u8ee2\u9001\u3057\u305f\u3044\u5834\u5408\u3001\u5bfe\u5fdc\u3059\u308b match \u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"<match example.**>\n  @type s3\n  s3_bucket example_bucket\n</match>\n")),(0,l.kt)("p",null,"\u305d\u308c\u305e\u308c\u5225\u306e\u30d0\u30b1\u30c3\u30c8 (",(0,l.kt)("inlineCode",{parentName:"p"},"hello_bucket"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"hoge_bucket"),")\u3078\u8ee2\u9001\u3057\u305f\u3044\u5834\u5408\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"<match example.hello>\n  @type s3\n  s3_bucket hello_bucket\n</match>\n<match example.hoge>\n  @type s3\n  s3_bucket hoge_bucket\n</match>\n")),(0,l.kt)("p",null,"\u8a73\u7d30\u306f",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/configuration/config-file"},"Config File Syntax"),"\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002"),(0,l.kt)("h3",{id:"\u30c1\u30e3\u30f3\u30af"},"\u30c1\u30e3\u30f3\u30af"),(0,l.kt)("p",null,"\u30c1\u30e3\u30f3\u30af\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u3001",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/configuration/buffer-section#chunk-keys"},"Chunk key"),"\u3068\u547c\u3070\u308c\u308b\u30ad\u30fc\u3092\u6307\u5b9a\u3057\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30ad\u30fc\u306b\u306f\u30bf\u30b0\u306e\u4ed6\u3001\u30bf\u30a4\u30e0\u30ad\u30fc\u306a\u3069\u3092\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u4f8b\u3048\u3070\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u305f\u5834\u5408\u3001\u30a4\u30d9\u30f3\u30c8\u306f 60 \u79d2\u3054\u3068\u3001\u304b\u3064\u30bf\u30b0\u3054\u3068\u306b\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3055\u308c\u30c1\u30e3\u30f3\u30af\u304c\u4f5c\u3089\u308c\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-fluent.conf"},"<buffer time, tag>\n  timekey 60\n</buffer>\n")),(0,l.kt)("p",null,"\u30c1\u30e3\u30f3\u30af\u3092 S3 \u3078\u8ee2\u9001\u3059\u308b\u969b\u3001\u4e0a\u8a18\u306e\u30c1\u30e3\u30f3\u30af\u306b\u4ed8\u4e0e\u3055\u308c\u305f\u30e6\u30cb\u30fc\u30af\u306a ID \u3092 KDS \u3078\u8ee2\u9001\u3059\u308c\u3070 Consumer \u5074\u3067 S3 \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u30e6\u30cb\u30fc\u30af\u306a ID \u306f Output Plugin \u306e",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/plugin-development/api-plugin-output#chunk.unique_id"},"chunk.unique_id"),"\u3001Chunk key \u3067\u5229\u7528\u3057\u305f\u30bf\u30b0\u3084\u30bf\u30a4\u30e0\u30ad\u30fc\u306f",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/plugin-development/api-plugin-output#chunk.metadata"},"chunk.metadata"),"\u304b\u3089\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002"),(0,l.kt)("h2",{id:"fluentd-\u81ea\u8eab\u306e\u30ed\u30b0\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b"},"Fluentd \u81ea\u8eab\u306e\u30ed\u30b0\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b"),(0,l.kt)("p",null,"\u30c1\u30e3\u30f3\u30af\u306e\u30e6\u30cb\u30fc\u30af\u306a ID \u3092 KDS \u3078\u8ee2\u9001\u3059\u308b\u306b\u306f\u3001Fluentd \u3078\u306e\u5165\u529b\u3068\u3057\u3066",(0,l.kt)("inlineCode",{parentName:"p"},"chunk.unique_id"),"\u304a\u3088\u3073",(0,l.kt)("inlineCode",{parentName:"p"},"chunk.metadata"),"\u3092\u4e0e\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306f ",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/deployment/logging#capture-fluentd-logs"},"Fluentd \u81ea\u8eab\u306e\u30ed\u30b0\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b"),"\u65b9\u6cd5\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nFluentd \u306f Fluentd \u81ea\u8eab\u306e\u30ed\u30b0\u3092",(0,l.kt)("inlineCode",{parentName:"p"},"fluent"),"\u30bf\u30b0\u3092\u3064\u3051\u3066\u7ba1\u7406\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30ed\u30b0\u306f",(0,l.kt)("inlineCode",{parentName:"p"},"<label @FLUENT_LOG>"),"\u5185\u3067",(0,l.kt)("inlineCode",{parentName:"p"},"match"),"\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u8a18\u8f09\u3059\u308b\u3053\u3068\u3067\u51e6\u7406\u3067\u304d\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8f09\u3059\u308b\u3068\u3001\u3059\u3079\u3066\u306e\u30ed\u30b0\u30ec\u30d9\u30eb\u306e\u30ed\u30b0\u3092 KDS \u3078\u8ee2\u9001\u3057\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"<label @FLUENT_LOG>\n  <match fluent.*>\n    @type kinesis_streams\n    ...\n  </match>\n</label>\n")),(0,l.kt)("p",null,"Fluentd \u306e S3 Output \u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u306f S3 \u8ee2\u9001\u6642\u306b",(0,l.kt)("inlineCode",{parentName:"p"},"chunk.unique_id"),"\u304a\u3088\u3073",(0,l.kt)("inlineCode",{parentName:"p"},"chunk.metadata"),"\u3092\u542b\u3093\u3060\u30ed\u30b0\u3092",(0,l.kt)("a",{parentName:"p",href:"https://github.com/fluent/fluent-plugin-s3/blob/2109abcaf6279fb92d0e877359d281aacba6b9ff/lib/fluent/plugin/out_s3.rb#L354"},"debug \u30ec\u30d9\u30eb\u3067\u51fa\u529b"),"\u3057\u307e\u3059\u3002\u4e0b\u8a18\u30ed\u30b0\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3057 KDS \u3078\u8ee2\u9001\u3059\u308c\u3070\u3001Consumer \u5074\u3067 S3 \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30ad\u30fc\u3092\u7279\u5b9a\u3067\u304d\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-out_s3.rb"},'log.debug "out_s3: write chunk #{dump_unique_id_hex(chunk.unique_id)} with metadata #{chunk.metadata} to s3://#{@s3_bucket}/#{s3path}"\n')),(0,l.kt)("h2",{id:"fluentd-\u306e\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3"},"Fluentd \u306e\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3"),(0,l.kt)("p",null,"\u4ee5\u4e0a\u306e\u5185\u5bb9\u3092\u8e0f\u307e\u3048\u3001S3 \u3078\u672c\u4f53\u3092\u8ee2\u9001\u3057\u3001 KDS \u3078\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u9001\u308b\u30b3\u30f3\u30d5\u30a3\u30ae\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u4f8b\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002"),(0,l.kt)("h3",{id:"\u30ed\u30b0\u30ec\u30d9\u30eb\u306e\u8a2d\u5b9a"},"\u30ed\u30b0\u30ec\u30d9\u30eb\u306e\u8a2d\u5b9a"),(0,l.kt)("p",null,"S3 Output \u30d7\u30e9\u30b0\u30a4\u30f3\u306f \u524d\u8ff0\u306e\u30c1\u30e3\u30f3\u30af\u60c5\u5831\u3092\u542b\u3080\u30ed\u30b0\u3092 ",(0,l.kt)("inlineCode",{parentName:"p"},"debug")," \u30ec\u30d9\u30eb\u3067\u51fa\u529b\u3059\u308b\u305f\u3081\u3001",(0,l.kt)("inlineCode",{parentName:"p"},"system"),"\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/deployment/logging#by-config-file"},"\u53c2\u8003")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"<system>\n  log_level debug\n  <log>\n    format json\n    time_format %Y-%m-%d\n  </log>\n</system>\n")),(0,l.kt)("h3",{id:"s3"},"S3"),(0,l.kt)("p",null,"\u3053\u3053\u3067\u306f\u5f8c\u306b",(0,l.kt)("a",{parentName:"p",href:"https://aws.amazon.com/jp/athena/"},"Amazon Athena"),"\u3092\u7528\u3044\u52b9\u7387\u7684\u306b\u30af\u30a8\u30ea\u3067\u304d\u308b\u3088\u3046\u3001Hive \u5f62\u5f0f (s3://year=yyyy/month=mm/day=dd) \u304b\u3064 gzip \u306b\u5727\u7e2e\u3057\u51fa\u529b\u3059\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001S3 \u30d0\u30b1\u30c3\u30c8\u3078\u306f",(0,l.kt)("inlineCode",{parentName:"p"},"s3://example_bucket/log/year=2023/month=01/day=05/{\u30c1\u30e3\u30f3\u30afID}.gzip"),"\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"<match example.log>\n    @type s3\n\n    s3_bucket example_bucket\n    s3_object_key_format ${tag[1]}/%{time_slice}/${chunk_id}.%{file_extension}\n    store_as gzip\n\n    time_slice_format year=%Y/month=%m/day=%d\n\n    <format>\n      @type json\n    </format>\n\n    <buffer time,tag>\n        timekey 10s\n    </buffer>\n</match>\n")),(0,l.kt)("p",null,"S3 \u306b\u4fdd\u5b58\u3055\u308c\u308b\u30c7\u30fc\u30bf\u4f8b\u3092\u4e0b\u8a18\u306b\u793a\u3057\u307e\u3059\u3002\u4e0a\u8a18\u306e\u8a2d\u5b9a\u306e\u5834\u5408 10 \u79d2\u306e\u9593\u306b\u5230\u9054\u3057\u305f",(0,l.kt)("a",{parentName:"p",href:"#%E6%83%B3%E5%AE%9A%E3%81%99%E3%82%8B%E3%83%AC%E3%82%B3%E3%83%BC%E3%83%89%E4%BE%8B"},"\u60f3\u5b9a\u3059\u308b\u30ec\u30b3\u30fc\u30c9"),"\u3092 json \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u4e26\u3079\u305f\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'{\n    [\n        {\n            "metrics_name": "metrics1",\n            "metrics_value": 24.1\n        },\n        {\n            "metrics_name": "metrics2",\n            "metrics_value": 312.56\n        },\n        ...\n    ]\n}\n{\n    [\n        {\n            "metrics_name": "metrics1",\n            "metrics_value": 28.1\n        },\n        {\n            "metrics_name": "metrics2",\n            "metrics_value": 356.13\n        },\n        ...\n    ]\n}\n...\n')),(0,l.kt)("h3",{id:"fluentd-\u81ea\u8eab\u306e\u30ed\u30b0\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0"},"Fluentd \u81ea\u8eab\u306e\u30ed\u30b0\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0"),(0,l.kt)("p",null,"Fluentd \u306e",(0,l.kt)("a",{parentName:"p",href:"https://docs.fluentd.org/filter"},"Filter Plugins"),"\u3092\u4f7f\u3046\u3068\u3001\u9001\u4fe1\u3057\u305f\u3044\u5185\u5bb9\u3092\u62bd\u51fa\u30fb\u52a0\u5de5\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u307e\u305a\u524d\u8ff0\u3057\u305f S3 Output \u30d7\u30e9\u30b0\u30a4\u30f3\u304c S3 \u8ee2\u9001\u3057\u305f\u6642\u306e\u30ed\u30b0\u3092\u4e0b\u8a18\u306e\u8a2d\u5b9a\u306b\u3088\u308a\u62bd\u51fa\u3057\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"  <filter fluent.debug>\n    @type grep\n    <regexp>\n      key message\n      pattern /out_s3: write chunk/\n    </regexp>\n  </filter>\n")),(0,l.kt)("p",null,"\u3053\u308c\u306b\u3088\u308a\u4f8b\u3048\u3070\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30ed\u30b0\u306e\u307f\u304c\u62bd\u51fa\u3067\u304d\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-.json"},'{\n    "time": "2023-01-06",\n    "level": "debug",\n    "message": "out_s3: write chunk 5f18e855a51912add1e8b26328a62d3d with metadata #<struct Fluent::Plugin::Buffer::Metadata timekey=1672969300, tag=\\"example.log\\", variables=nil> to s3://example_bucket/log/year=2023/month=01/day=06/5f18e855a51912add1e8b26328a62d3d.gz",\n}\n')),(0,l.kt)("p",null,"\u7d9a\u3044\u3066\u4e0a\u8a18\u306e\u62bd\u51fa\u3057\u305f\u30ed\u30b0\u306b\u5bfe\u3057\u3001\u5143\u306e\u30bf\u30b0 (\u3053\u3053\u3067\u306f ",(0,l.kt)("inlineCode",{parentName:"p"},"example.log"),") \u3092\u542b\u3080\u90e8\u5206\u3092\u6b63\u898f\u8868\u73fe\u306b\u3088\u308a\u53d6\u5f97\u3057\u3001\u5f8c\u8ff0\u3059\u308b KDS \u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30ad\u30fc\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u305f\u3081\u8ffd\u52a0\u3057\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'  <filter fluent.debug>\n    @type record_transformer\n    enable_ruby\n    <record>\n      # \u5143\u306e\u30bf\u30b0\u3092\u6b63\u898f\u8868\u73fe\u3067\u62bd\u51fa\u3057kinesis\u306epartition key\u306b\u5229\u7528\n      partition_key ${record["message"].match(/tag=.+,/)[0].slice(0..-2)}\n    </record>\n  </filter>\n')),(0,l.kt)("p",null,"\u4e0b\u8a18\u306e\u3088\u3046\u306b",(0,l.kt)("inlineCode",{parentName:"p"},"parition_key"),"\u304c\u65b0\u305f\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'{\n    "time": "2023-01-06",\n    "level": "debug",\n    "message": ...\n    "partition_key": "tag=\\"example.log\\""\n}\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"fluent.debug"),"\u30bf\u30b0\u306e\u30ec\u30b3\u30fc\u30c9\u3092 KDS \u3078\u9001\u4fe1\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u4e0b\u8a18\u306b\u3088\u308a\u9664\u5916\u3057\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"  <filter fluent.debug>\n    @type grep\n    <exclude>\n      key partition_key\n      pattern /fluent.debug/\n    </exclude>\n  </filter>\n")),(0,l.kt)("h3",{id:"kds"},"KDS"),(0,l.kt)("p",null,"\u5148\u307b\u3069\u62bd\u51fa\u3057\u305f\u5143\u306e\u30bf\u30b0\u3092\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30ad\u30fc\u306b\u8a2d\u5b9a\u3057 KDS \u3078\u9001\u4fe1\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u540c\u3058\u30bf\u30b0\u306e\u30ec\u30b3\u30fc\u30c9\u306f\u6bce\u56de\u540c\u3058\u30b7\u30e3\u30fc\u30c9\u306b\u9001\u4fe1\u3055\u308c\u9806\u5e8f\u6027\u304c\u62c5\u4fdd\u3055\u308c\u307e\u3059 (KDS \u306f\u30b7\u30e3\u30fc\u30c9\u5185\u3067\u306e\u307f\u9806\u5e8f\u3092\u4fdd\u8a3c\u3057\u307e\u3059)\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"  <match fluent.debug>\n    @type kinesis_streams\n    stream_name example_stream\n\n    partition_key partition_key\n  </match>\n")),(0,l.kt)("p",null,"\u306a\u304a\u6700\u7d42\u7684\u306b KDS \u3078\u9001\u4fe1\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306f\u4e0b\u8a18\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u4f8b\u306e\u5834\u5408",(0,l.kt)("inlineCode",{parentName:"p"},'tag="example.log"'),"\u304c\u9001\u4fe1\u5148\u306e\u30b7\u30e3\u30fc\u30c9\u6c7a\u5b9a\u306b\u5229\u7528\u3055\u308c\u307e\u3059\u3002Consumer \u5074\u3067\u306f",(0,l.kt)("inlineCode",{parentName:"p"},"message"),"\u306b\u542b\u307e\u308c\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30ad\u30fc\u3092\u7528\u3044\u3066\u672c\u4f53\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'{\n    "time": "2023-01-06",\n    "level": "debug",\n    "message": "out_s3: write chunk 5f18e855a51912add1e8b26328a62d3d with metadata #<struct Fluent::Plugin::Buffer::Metadata timekey=1672969300, tag=\\"example.log\\", variables=nil> to s3://example_bucket/log/year=2023/month=01/day=06/5f18e855a51912add1e8b26328a62d3d.gz",\n    "partition_key": "tag=\\"example.log\\""\n}\n')),(0,l.kt)("p",null,"\u4ee5\u4e0a\u306e\u5185\u5bb9\u3092\u4e00\u3064\u306b\u307e\u3068\u3081\u305f\u3082\u306e\u304c\u4e0b\u8a18\u3068\u306a\u308a\u307e\u3059\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-fluent.conf"},'<system>\n  log_level debug\n  <log>\n    format json\n    time_format %Y-%m-%d\n  </log>\n</system>\n\n<match example.log>\n    @type s3\n\n    s3_bucket example_bucket\n    s3_object_key_format ${tag[1]}/%{time_slice}/${chunk_id}.%{file_extension}\n    store_as gzip\n\n    time_slice_format year=%Y/month=%m/day=%d\n\n    <format>\n      @type json\n    </format>\n\n    <buffer time,tag>\n        timekey 10s\n    </buffer>\n</match>\n\n<label @FLUENT_LOG>\n  <filter fluent.debug>\n    @type grep\n    <regexp>\n      key message\n      pattern /out_s3: write chunk/\n    </regexp>\n  </filter>\n  <filter fluent.debug>\n    @type record_transformer\n    enable_ruby\n    <record>\n      partition_key ${record["message"].match(/tag=.+,/)[0]}\n    </record>\n  </filter>\n  <filter fluent.debug>\n    @type grep\n    <exclude>\n      key partition_key\n      pattern /fluent.debug/\n    </exclude>\n  </filter>\n\n  <match fluent.debug>\n    @type kinesis_streams\n    stream_name example_stream\n    partition_key partition_key\n\n    <buffer time>\n      timekey 10s\n    </buffer>\n  </match>\n</label>\n')),(0,l.kt)("h2",{id:"\u307e\u3068\u3081"},"\u307e\u3068\u3081"),(0,l.kt)("p",null,"\u672c\u8a18\u4e8b\u3067\u306f Fluentd \u304b\u3089 Kinesis Data Streams \u3078\u5927\u304d\u306a\u30b5\u30a4\u30ba\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u53d6\u308a\u6271\u3046\u5177\u4f53\u7684\u306a\u65b9\u6cd5\u4f8b\u306b\u3064\u3044\u3066\u3054\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002\u3054\u53c2\u8003\u306b\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002"))}o.isMDXComponent=!0},709:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/arch-65816c847eb129ab558e9547a43a095d.png"},5318:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/buf-9fe916e307db9ecb9ce0b96cc6924171.png"}}]);